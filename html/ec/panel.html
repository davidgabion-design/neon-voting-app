<section id="ecPanel" class="screen">
  <div class="card">
    <div class="section-title">
      <div>
        <h2 style="margin:0;font-size:18px"><i class="fas fa-user-shield"></i> <span data-i18n="ec_dashboard">EC Dashboard</span></h2>
        <div class="subtext">
          <span id="ecOrgName">Organization</span>
          <span style="opacity:.5">‚Ä¢</span>
          ID: <span id="ecOrgIdDisplay">‚Äî</span>
          <span style="opacity:.5">‚Ä¢</span>
          <span data-i18n="type">Type</span>: <span id="ecElectionType" class="badge info">‚Äî</span>
          <span style="opacity:.5">‚Ä¢</span>
          <span data-i18n="status">Status</span>: <span id="ecElectionStatus" class="badge">Not Started</span>
          <span style="opacity:.5">‚Ä¢</span>
          <span class="sync-indicator">
            <div class="sync-pulse"></div>
            <span>Syncing to Global Dashboard</span>
          </span>
        </div>
      </div>
      <div class="row">
        <select id="ecLangSelect" class="input" style="max-width:110px;padding:6px 10px;font-size:13px" title="Change Language">
          <option value="ENG">üá¨üáß ENG</option>
          <option value="SPA">üá™üá∏ SPA</option>
          <option value="FRE">üá´üá∑ FRE</option>
          <option value="POR">üáµüáπ POR</option>
          <option value="TWI">üá¨üá≠ TWI</option>
        </select>
        <button class="btn neon-btn-outline logout-btn"><i class="fas fa-sign-out-alt"></i> <span data-i18n="logout">Logout</span></button>
        <button id="ec-back" class="btn neon-btn-outline"><i class="fas fa-home"></i> <span data-i18n="gateway">Gateway</span></button>
      </div>
    </div>

    <!-- ‚úÖ PATCH 3: Approval Status Banner -->
    <div id="ecApprovalBanner"></div>

    <!-- EC Panel Tabs with Bulk Invite placed correctly -->
    <div id="electionCountdownBanner" class="countdown-banner" style="display:none;margin:10px 0;padding:10px 12px;border:1px solid rgba(0,255,255,.2);border-radius:12px;background:rgba(0,255,255,.06);color:#eaf2ff;font-weight:600"></div>
    <div id="ecTabs" class="tabs" role="tablist" aria-label="EC Tabs">
      <button class="tab-btn active" data-ec-tab="voters">
        <i class="fas fa-users"></i> <span data-i18n="voters">Voters</span>
      </button>
      <button class="tab-btn" data-ec-tab="bulk-invite">
        <i class="fas fa-mail-bulk"></i> <span data-i18n="bulk_invite">Bulk Invite</span>
      </button>
      <button class="tab-btn" data-ec-tab="invites">
        <i class="fas fa-envelope"></i> <span data-i18n="invites">Invites</span>
      </button>
      <button class="tab-btn" data-ec-tab="positions">
        <i class="fas fa-list-ol"></i> <span data-i18n="positions">Positions</span>
      </button>
      <button class="tab-btn" data-ec-tab="candidates">
        <i class="fas fa-user-friends"></i> <span data-i18n="candidates">Candidates</span>
      </button>
      <button class="tab-btn" data-ec-tab="outcomes">
        <i class="fas fa-chart-bar"></i> <span data-i18n="outcomes">Outcomes</span>
      </button>
      <button class="tab-btn" data-ec-tab="settings">
        <i class="fas fa-cog"></i> <span data-i18n="settings">Settings</span>
      </button>
      <button class="tab-btn" data-ec-tab="approval">
        <i class="fas fa-check-circle"></i> <span data-i18n="approval">Approval</span>
      </button>
    </div>

    <div style="margin-top:14px">
      <!-- Voters Tab -->
      <div id="ecContent-voters" class="ec-content" style="display: block;">
        <div class="row" style="justify-content:space-between">
          <div class="subtext">Add and manage voters. Changes sync to global dashboard instantly.</div>
          <div class="row">
            <button class="btn neon-btn-outline" onclick="switchToBulkInvite()">
              <i class="fas fa-mail-bulk"></i> Bulk Invite
            </button>
            <button class="btn neon-btn" onclick="showAddVoterModal()">
              <i class="fas fa-user-plus"></i> Add Voter
            </button>
          </div>
        </div>
        
        <!-- Voter Stats (Synced to Dashboard) -->
        <div class="outcome-stats" style="margin: 12px 0">
          <div class="stat-card">
            <div class="stat-value" id="ecVoterCount">0</div>
            <div class="stat-label">Total Voters</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="ecVotedCount">0</div>
            <div class="stat-label">Voted</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="ecTurnoutPercent">0%</div>
            <div class="stat-label">Turnout</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="ecInvitedCount">0</div>
            <div class="stat-label">Invited</div>
          </div>
        </div>
        
        <div id="ecVoterList" style="margin-top:12px"></div>
      </div>

      <!-- Bulk Invite Tab -->
      <div id="ecContent-bulk-invite" class="ec-content" style="display:none">
        <div class="bulk-invite-header">
          <div>
            <h3 style="margin:0"><i class="fas fa-mail-bulk"></i> <span data-i18n="bulk_voter_invite">Bulk Voter Invite</span></h3>
            <p class="subtext">Invite multiple voters at once using CSV, Excel, or manual entry</p>
          </div>
          <button class="btn neon-btn-outline" onclick="showInviteHistory()">
            <i class="fas fa-history"></i> <span data-i18n="invite_history">Invite History</span>
          </button>
        </div>

        <div class="bulk-invite-tabs">
          <button class="bulk-invite-tab active" onclick="showBulkTab('manual')">
            <i class="fas fa-keyboard"></i> <span data-i18n="manual_entry">Manual Entry</span>
          </button>
          <button class="bulk-invite-tab" onclick="showBulkTab('csv')">
            <i class="fas fa-file-csv"></i> <span data-i18n="csv_upload">CSV Upload</span>
          </button>
          <button class="bulk-invite-tab" onclick="showBulkTab('excel')">
            <i class="fas fa-file-excel"></i> <span data-i18n="excel_upload">Excel Upload</span>
          </button>
          <button class="bulk-invite-tab" onclick="showBulkTab('template')">
            <i class="fas fa-layer-group"></i> <span data-i18n="templates">Templates</span>
          </button>
        </div>

        <!-- Manual Entry Tab -->
        <div id="bulkTab-manual" class="bulk-invite-container">
          <div class="card" style="margin-bottom: 16px; padding: 16px">
            <h4 style="margin:0 0 12px 0"><i class="fas fa-keyboard"></i> Enter Voter Details</h4>
            <p class="subtext" style="margin-bottom: 16px">
              Enter one voter per line in format: <code>Email/Phone, Full Name, PIN (optional)</code><br>
              Example: <code>john@example.com, John Doe, 1234</code>
            </p>
            
            <textarea id="bulkVoterText" class="bulk-textarea" placeholder="john@example.com, John Doe, 1234
jane@example.com, Jane Smith, 5678
+1234567890, Bob Johnson, 9012"></textarea>
            
            <div class="bulk-preview" id="manualPreview">
              <div style="text-align: center; padding: 20px">
                <div class="spinner" style="width: 24px; height: 24px; margin: 0 auto 10px"></div>
                <div class="subtext">Preview will appear here</div>
              </div>
            </div>
            
            <div class="bulk-actions">
              <button class="btn neon-btn-outline" onclick="previewBulkVoters()">
                <i class="fas fa-eye"></i> Preview
              </button>
              <button class="btn neon-btn" onclick="sendBulkInvites()" id="sendBulkBtn">
                <i class="fas fa-paper-plane"></i> Send Invites
              </button>
            </div>
          </div>
        </div>

        <!-- CSV Upload Tab -->
        <div id="bulkTab-csv" class="bulk-invite-container" style="display:none">
          <div class="card" style="margin-bottom: 16px; padding: 16px">
            <h4 style="margin:0 0 12px 0"><i class="fas fa-file-csv"></i> Upload CSV File</h4>
            <p class="subtext" style="margin-bottom: 16px">
              Upload a CSV file with columns: <code>email/phone, name, pin</code><br>
              First row should be headers. Maximum file size: 5MB
            </p>
            
            <div class="upload-area" id="csvUploadArea" onclick="document.getElementById('csvFileInput').click()">
              <div class="upload-icon">
                <i class="fas fa-cloud-upload-alt"></i>
              </div>
              <div class="upload-text">Click to upload CSV file</div>
              <div class="upload-subtext">or drag and drop file here</div>
            </div>
            
            <input type="file" id="csvFileInput" class="file-input" accept=".csv" onchange="handleCSVUpload(this)">
            
            <div id="csvPreview" class="csv-preview" style="display:none">
              <!-- CSV preview will be inserted here -->
            </div>
            
            <div class="bulk-actions" style="margin-top: 20px">
              <button class="btn neon-btn" onclick="processCSVFile()" id="processCSVBtn" disabled>
                <i class="fas fa-check"></i> Process CSV
              </button>
            </div>
          </div>
        </div>

        <!-- Excel Upload Tab -->
        <div id="bulkTab-excel" class="bulk-invite-container" style="display:none">
          <div class="card" style="margin-bottom: 16px; padding: 16px">
            <h4 style="margin:0 0 12px 0"><i class="fas fa-file-excel"></i> Upload Excel File</h4>
            <p class="subtext" style="margin-bottom: 16px">
              Upload an Excel file (XLSX) with columns: <code>email/phone, name, pin</code><br>
              First row should be headers. Maximum file size: 10MB
            </p>
            
            <div class="upload-area" id="excelUploadArea" onclick="document.getElementById('excelFileInput').click()">
              <div class="upload-icon">
                <i class="fas fa-file-excel"></i>
              </div>
              <div class="upload-text">Click to upload Excel file</div>
              <div class="upload-subtext">.xlsx files only</div>
            </div>
            
            <input type="file" id="excelFileInput" class="file-input" accept=".xlsx,.xls" onchange="handleExcelUpload(this)">
            
            <div class="bulk-actions" style="margin-top: 20px">
              <button class="btn neon-btn" onclick="processExcelFile()" id="processExcelBtn" disabled>
                <i class="fas fa-check"></i> Process Excel
              </button>
            </div>
          </div>
        </div>

        <!-- Templates Tab -->
        <div id="bulkTab-template" class="bulk-invite-container" style="display:none">
          <div class="card" style="margin-bottom: 16px; padding: 16px">
            <h4 style="margin:0 0 12px 0"><i class="fas fa-layer-group"></i> Invite Templates</h4>
            <p class="subtext" style="margin-bottom: 16px">
              Use pre-built templates for different types of elections
            </p>
            
            <div class="template-container">
              <div class="template-card" onclick="selectTemplate('university')">
                <div class="template-name">University Election</div>
                <div class="template-description">Template for student council elections with student emails</div>
                <div class="template-stats">
                  <span><i class="fas fa-users"></i> Student format</span>
                  <span><i class="fas fa-envelope"></i> Email invites</span>
                </div>
              </div>
              
              <div class="template-card" onclick="selectTemplate('corporate')">
                <div class="template-name">Corporate Board Election</div>
                <div class="template-description">Template for corporate board elections with employee emails</div>
                <div class="template-stats">
                  <span><i class="fas fa-building"></i> Employee format</span>
                  <span><i class="fas fa-id-badge"></i> Department info</span>
                </div>
              </div>
              
              <div class="template-card" onclick="selectTemplate('community')">
                <div class="template-name">Community Election</div>
                <div class="template-description">Template for community associations with phone numbers</div>
                <div class="template-stats">
                  <span><i class="fas fa-phone"></i> Phone invites</span>
                  <span><i class="fas fa-home"></i> Address info</span>
                </div>
              </div>
            </div>
            
            <div class="bulk-actions" style="margin-top: 20px">
              <button class="btn neon-btn" onclick="useSelectedTemplate()" id="useTemplateBtn" disabled>
                <i class="fas fa-check"></i> Use Template
              </button>
            </div>
          </div>
        </div>

        <!-- Progress Bar -->
        <div class="bulk-progress" id="bulkProgress" style="display:none">
          <div class="section-title">
            <h4 style="margin:0"><i class="fas fa-sync"></i> Sending Invites</h4>
            <span class="badge info" id="progressStatus">Processing...</span>
          </div>
          
          <div class="bulk-progress-bar">
            <div class="bulk-progress-fill" id="progressFill" style="width: 0%"></div>
          </div>
          
          <div class="bulk-progress-text">
            <span id="progressCurrent">0</span>
            <span id="progressTotal">0</span>
          </div>
          
          <div class="bulk-actions" style="margin-top: 20px">
            <button class="btn neon-btn-outline" onclick="cancelBulkInvite()">
              <i class="fas fa-times"></i> Cancel
            </button>
          </div>
        </div>
      </div>

      <!-- Invites Tracking Tab -->
      <div id="ecContent-invites" class="ec-content" style="display:none">
        <div class="row" style="justify-content:space-between;margin-bottom:15px">
          <div>
            <h3><i class="fas fa-envelope"></i> <span data-i18n="invitation_tracking">Invitation Tracking</span></h3>
            <p class="subtext" data-i18n="monitor_sent_invitations">Monitor sent invitations, resend, and track engagement metrics.</p>
          </div>
          <div style="display:flex;gap:8px">
            <button class="btn neon-btn-outline" onclick="loadInvitesTracking()">
              <i class="fas fa-refresh"></i> <span data-i18n="refresh">Refresh</span>
            </button>
          </div>
        </div>
        <div id="ecContent-invites-list"></div>
      </div>

      <!-- Positions Tab -->
      <div id="ecContent-positions" class="ec-content" style="display:none">
        <div class="row" style="justify-content:space-between">
          <div class="subtext">Create positions (single/multiple choice). Synced to dashboard.</div>
          <button class="btn neon-btn" onclick="showAddPositionModal()"><i class="fas fa-plus-circle"></i> Add Position</button>
        </div>
        <div id="ecPositionList" style="margin-top:12px"></div>
      </div>

      <!-- Candidates Tab -->
      <div id="ecContent-candidates" class="ec-content" style="display:none">
        <div class="row" style="justify-content:space-between">
          <div class="subtext">Add candidates to positions. Synced to dashboard.</div>
          <button class="btn neon-btn" onclick="showAddCandidateModal()"><i class="fas fa-user-plus"></i> Add Candidate</button>
        </div>
        <div id="ecCandidateList" style="margin-top:12px"></div>
      </div>

      <!-- Outcomes Tab -->
      <div id="ecContent-outcomes" class="ec-content" style="display:none">
        <div class="card" style="padding: 14px">
          <div class="section-title">
            <div>
              <h3 style="margin:0 0 8px"><i class="fas fa-chart-bar"></i> Real-time Election Outcomes</h3>
              <div class="subtext" style="margin-bottom:12px">Live results synchronized with global dashboard</div>
            </div>
            <div class="real-time-indicator">
              <div class="pulse-dot"></div>
              <span style="font-size:11px">Live Updates</span>
            </div>
          </div>
          
          <!-- Election Statistics -->
          <div class="outcome-stats">
            <div class="stat-card">
              <div class="stat-value" id="totalVotes">0</div>
              <div class="stat-label">Total Votes</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="voterTurnout">0%</div>
              <div class="stat-label">Voter Turnout</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="positionsCount">0</div>
              <div class="stat-label">Positions</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="candidatesCount">0</div>
              <div class="stat-label">Candidates</div>
            </div>
          </div>
          
          
          <!-- Export Actions -->
          <div class="export-actions" style="margin:12px 0; display:flex; gap:10px; flex-wrap:wrap;">
            <button class="btn neon-btn-outline" onclick="exportResultsCSV(window.currentOrgId)"><i class="fas fa-file-csv"></i> Export Results (CSV)</button>
            <button class="btn neon-btn-outline" onclick="exportResultsPDF(window.currentOrgId)"><i class="fas fa-file-pdf"></i> Export Results (PDF)</button>
          </div>
<!-- Position-wise Results -->
          <div id="ecOutcomeResults" style="margin-top: 20px;">
            <div style="text-align: center; padding: 40px 20px;">
              <div class="spinner" style="width: 30px; height: 30px; margin: 0 auto 15px;"></div>
              <div class="subtext">Loading real-time election outcomes...</div>
              <div class="subtext" style="margin-top: 8px; font-size: 10px;">Syncing with global dashboard</div>
            </div>
          </div>
          
          <!-- Last Update Time -->
          <div class="subtext" style="text-align: center; margin-top: 16px; font-size: 10px;">
            <i class="fas fa-sync"></i> Last updated: <span id="lastUpdateTime">Just now</span>
          </div>
        </div>
      </div>

      <!-- Settings Tab -->
      <div id="ecContent-settings" class="ec-content" style="display:none">
        <div class="card" style="margin-bottom: 14px; padding: 14px">
          <h3 style="margin: 0 0 8px">Election Settings</h3>
          
          <div class="form-grid">
            <div class="form-group">
              <label for="electionTitle">Election Title</label>
              <input id="electionTitle" class="input" placeholder="e.g. 2025 Board Elections">
            </div>
            
            <div class="form-group">
              <label for="electionStart">Start Date & Time</label>
              <input id="electionStart" class="input" type="datetime-local">
            </div>
            
            <div class="form-group">
              <label for="electionEnd">End Date & Time</label>
              <input id="electionEnd" class="input" type="datetime-local">
            </div>
            
            <div class="form-group">
              <label>
                <input type="checkbox" id="resultsPublic"> Make results public after election
              </label>
            </div>
            
            <div class="form-group">
              <label>
                <input type="checkbox" id="realTimeSync" checked> Sync to global dashboard in real-time
              </label>
              <div class="subtext" style="margin-top: 4px;">When enabled, all changes update Super Admin dashboard instantly</div>
            </div>
            
            <button class="btn neon-btn" onclick="saveElectionSettings()">
              <i class="fas fa-save"></i> Save Settings
            </button>
          </div>
        </div>
      </div>

      <!-- Approval Tab -->
      <div id="ecContent-approval" class="ec-content" style="display:none">
        <div class="card" style="padding: 14px">
          <div class="section-title">
            <div>
              <h3 style="margin: 0 0 4px"><i class="fas fa-clipboard-check"></i> Approval Status</h3>
              <div class="subtext">Track your election's approval progress with Super Admin</div>
            </div>
            <span class="badge" id="approvalBadge">Not Submitted</span>
          </div>
          
          <div id="approvalDetails" style="margin-top: 12px">
            <div class="review-item">
              <span class="k">Current Status:</span>
              <span class="v" id="currentApprovalStatus">Not Submitted</span>
            </div>
            <div class="review-item">
              <span class="k">Submitted Date:</span>
              <span class="v" id="submittedDate">‚Äî</span>
            </div>
            <div class="review-item">
              <span class="k">Reviewed By:</span>
              <span class="v" id="reviewedBy">‚Äî</span>
            </div>
            <div class="review-item">
              <span class="k">Comments:</span>
              <span class="v" id="approvalComments">‚Äî</span>
            </div>
          </div>
          
          <div style="margin-top: 16px">
            <h4 style="margin: 0 0 8px">Submit for Approval</h4>
            <p class="subtext">Complete all requirements below before submission:</p>
            
            <ul id="approvalRequirements" class="checklist" style="margin: 12px 0">
              <li id="reqVoters">‚ùå At least 1 voter added</li>
              <li id="reqPositions">‚ùå At least 1 position created</li>
              <li id="reqCandidates">‚ùå All positions have candidates</li>
              <li id="reqSchedule">‚ùå Election schedule is set</li>
            </ul>
            
            <button id="finalSubmitBtn" class="btn neon-btn btn-block" disabled onclick="submitForApprovalFinal()">
              <i class="fas fa-paper-plane"></i> Submit to Super Admin
            </button>
            
            <div id="approvalMessage" class="subtext" style="margin-top: 8px"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
